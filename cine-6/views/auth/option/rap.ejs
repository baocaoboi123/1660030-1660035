<section style=" background-color: #000;"   id="about" class="about py-5">
    <div class="row align-items-center container my-5 mx-auto">        
        <div class="col-lg-12 col-md-12 col-12 w-100 ">
            
            <div class="d-flex phim-info"> 
                    <div class="input-group">
                            <div class="input-group-prepend">
                                <span style="text-transform:uppercase;border-color:rgb(255, 231, 16);  background-color: rgb(255, 231, 16);" class="input-group-text">Chọn Cụm Rạp</span>
                                <select  name="selectedname" id="selectedname">
                                <% for(const key in foundCumRap){%>
                                    <option value="<%- foundCumRap[key].IDcumrap%>"><%- foundCumRap[key].Tencumrap%></option>
                                <%}%>                                       
                                </select>   
                            </div>
                        </div>
                <!-- <span style="width: 150px; background-color: lightgray;"  id="add" class="ml-auto p-2">Thêm Rạp</span>  -->
                <input readonly style="background-color: lightgray;" id="add" class="btn submit"  value="Thêm Rạp"/>
                        
            </div>  
            <main class="m">
                <% for(const key in foundCumRap){%>
                <div id="<%- foundCumRap[key].IDcumrap%>" class="phim data">
                    <%for(const temp in foundRap){
                        if(foundCumRap[key].IDcumrap === foundRap[temp].CumRapIDcumrap){%>
                            <ul class="caption-style-4">
                                <li>
                                    <img src="/images/page/signin-image.jpg" alt="">
                                        <div class="caption">
                                            <div class="blur"></div>
                                            <div class="caption-text">
                                                <h1><%-foundRap[temp].Tenrap%></h1>
                                                <div>
                                                    <button onclick="scrollToTopRap('<%-foundCumRap[key].Tencumrap%>','<%-foundRap[temp].IDrap%>','<%-foundCumRap[key].IDcumrap%>','<%-foundRap[temp].Tenrap%>', '<%-foundRap[temp].Loairap%>', '<%-foundRap[temp].Kichthuocngang%>', '<%-foundRap[temp].Kichthuocdoc%>')"  style="background-color: lightgreen;  border-radius: 5px; border: none;">EDIT</button>
                                                    <button onclick="deleteRap('<%-foundRap[temp].IDrap%>')"  style="background-color: lightcoral;  border-radius: 5px; border: none;">DELETE</button>            
                                                </div>
                                            </div>
                                        </div>
                                </li>			
                            </ul>
                            <div class="phim-info ">
                                <p><%-foundRap[temp].Tenrap%></p>
                            </div>                       
                    <%}}%> 
                </div>
                <br>
                <%}%>
            </main>
        </div>
    </div>  
</section>








<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js">
</script>
<script>
    $(document).ready(function(){
        $("#selectedname").on('change', function(){
            $(".data").hide();
            $("#" + $(this).val()).fadeIn(700);
        }).change();
    });

 
    
</script>

<!----------Edit Rap------------>
<div class="bg-modal">
        <div style="background-color: lightgoldenrodyellow;" class="modal-content ">             
            <div onclick="tatrap()" class="close">+</div>
            <div class="ui container">
                <form id="formeditrap" class="ui form" method="POST"  >
                    <div style="background-color: rgb(247, 247, 220);" class="card w-100" style="width: 18rem;">
                            
                            <div class="card-body">
                              <h5 style="text-transform: uppercase; background-color: lawngreen" class="card-title">Chỉnh Sửa Rạp</h5>
                              <!-- <input type="text" name="idrap" id="idrap"> -->
                              <input hidden type="text" name="idcumrap" id="idcumrap">
                              

                             <div  class="input-group">
                                    <div style=" box-sizing: border-box; width: 100%;" class="input-group-prepend">
                                        <span style="text-transform: uppercase; width: 170px; background-color: lightskyblue; border: none;" class="input-group-text">ID Rạp </span>
                                        <input  readonly type="text" name="idrap" id="idrap">

                                    </div>
                                </div>
                                <div  style="margin-top:10px;" class="input-group">
                                        <div style=" box-sizing: border-box; width: 100%;" class="input-group-prepend">
                                            <span style="text-transform: uppercase; width: 170px; background-color: lightcoral; border: none;" class="input-group-text">Tên Cụm Rạp </span>
                                            <input readonly type="text" name="temp_tencumrap" id="temp_tencumrap">

                                        </div>

                                </div>
                                <div style="margin-top:10px;" class="input-group">
                                        <div style=" box-sizing: border-box; width: 100%;" class="input-group-prepend">
                                                <span style="text-transform: uppercase; width: 170px; background-color: lightgray; border: none;" class="input-group-text">Tên rạp </span>
                                            <input  type="text" name="rrap" id="rrap">

                                        </div>

                                </div>
                                <!-- <div style="margin-top:10px;" class="input-group">
                                        <div style=" box-sizing: border-box; width: 100%;" class="input-group-prepend">
                                                <span style="text-transform: uppercase; width: 170px; background-color: lightgreen; border: none;" class="input-group-text">Loại Rạp </span>
                                            <input placeholder="2D / 3D / 4DX" type="text" name="loairap" id="loairap">

                                        </div>

                                </div> -->
                                <div style="margin-top:10px;" class="input-group">
                                        <div style=" box-sizing: border-box; width: 100%;" class="input-group-prepend">
                                                <span style="text-transform: uppercase; width: 170px; background-color: lightgreen; border: none;" class="input-group-text">Loại Rạp </span>
                                            
                                                <select onchange="weqww()" name="selectloairap1" id="selectloairap1">
                                                    <option selected value="2D">2D</option>
                                                    <option value="3D">3D</option>
                                                    <option value="4DX">4DX</option>
    
                                                </select>
                                                <input hidden placeholder="2D / 3D / 4DX" type="text" name="loairap" id="loairap">

                                            
                                                <input  hidden type="text" name="edit_loairap" id="edit_loairap">
    
                                        </div>
    
                                </div>
                                <div style="margin-top:10px;" class="form-group input-group">
                                        <div style=" box-sizing: border-box; width: 100%;" class="input-group-prepend">
                                                <span style="text-transform: uppercase; width: 170px; background-color: lightcoral; border: none;" class="input-group-text">Kích Thước Dọc </span>
                                                <input id="ktdoc" name="ktdoc" type="text" placeholder="'Trường này phải là số nguyên (0 < KTD < 9)'" class="form-control">
                                        </div>
                                            <span class="form-message"></span>
                                    </div>
                                <!-- <div style="margin-top:10px;" class="input-group">
                                        <div style=" box-sizing: border-box; width: 100%;" class="input-group-prepend">
                                                <span style="text-transform: uppercase; width: 170px; background-color: lightpink; border: none;" class="input-group-text">Kích Thước Dọc  </span>
                                            <input  type="text" name="ktdoc" id="ktdoc">

                                        </div>

                                </div>
                                <div style="margin-top:10px;" class="input-group">
                                        <div style=" box-sizing: border-box; width: 100%;" class="input-group-prepend">
                                                <span style="text-transform: uppercase; width: 170px; background-color: lightseagreen; border: none;" class="input-group-text">Kích Thước Ngang </span>
                                            <input type="text" name="ktngang" id="ktngang">

                                        </div>

                                </div> -->
                                <div style="margin-top:10px;" class="form-group input-group">
                                        <div style=" box-sizing: border-box; width: 100%;" class="input-group-prepend">
                                                <span style="text-transform: uppercase; width: 170px; background-color: lightcoral; border: none;" class="input-group-text">Kích Thước Ngang </span>
                                                <input id="ktngang" name="ktngang" type="text" placeholder="'Trường này phải là số nguyên (0 < KTD < 6)'" class="form-control">
                                        </div>
                                            <span class="form-message"></span>
                                    </div>
        


                            
                            <input hidden type="text"  name="check_option" id="check_option">

                            </div>
                            
                           
                    </div>
                    
                    <button class="ui fluid blue button" type="submit">Save</button>
                </form>
            </div>
    
    
           
        </div>
</div>

<!----------Them Rap------------>

<div class="bg-modal1">
        <div style="background-color: lightgoldenrodyellow;" class="modal-content ">             
            <div onclick="tatrap1()" class="close">+</div>
            <div class="ui container">
                <form id="formeaddrap"  class="ui form" method="POST"  >
                    <div style="background-color: rgb(247, 247, 220);" class="card w-100" style="width: 18rem;">
                        <div class="card-body">
                            <h5 style="text-transform: uppercase; background-color: lawngreen" class="card-title">Thêm Rạp</h5>
                            
                            <input hidden type="text" value="1" name="check_option" id="check_option">
                            
                            
                            
                            <div  style="margin-top:10px;" class="input-group">
                                    <div style=" box-sizing: border-box; width: 100%;" class="input-group-prepend">
                                        <span style="text-transform: uppercase; width: 170px; background-color: lightcoral; border: none;" class="input-group-text">ID Cụm Rạp </span>
                                        <input readonly type="text" name="temp_tencumrap1" id="temp_tencumrap1">
                                    </div>

                            </div>
                            
                            <div style="margin-top:10px;" class="input-group">
                                    <div style=" box-sizing: border-box; width: 100%;" class="input-group-prepend">
                                            <span style="text-transform: uppercase; width: 170px; background-color: lightgray; border: none;" class="input-group-text">Tên rạp </span>
                                        <input  type="text" name="rrap" id="rrap">

                                    </div>

                            </div>
                            <div style="margin-top:10px;" class="input-group">
                                    <div style=" box-sizing: border-box; width: 100%;" class="input-group-prepend">
                                            <span style="text-transform: uppercase; width: 170px; background-color: lightgreen; border: none;" class="input-group-text">Loại Rạp </span>
                                        
                                            <select onchange="weq()" name="selectloairap" id="selectloairap">
                                                <option selected value="2D">2D</option>
                                                <option value="3D">3D</option>
                                                <option value="4DX">4DX</option>

                                            </select>
                                        
                                        
                                            <input hidden    value="2D" type="text" name="add_loairap" id="add_loairap">

                                    </div>

                            </div>
                            <div style="margin-top:10px;" class="form-group input-group">
                                <div style=" box-sizing: border-box; width: 100%;" class="input-group-prepend">
                                        <span style="text-transform: uppercase; width: 170px; background-color: lightcoral; border: none;" class="input-group-text">Kích Thước Dọc </span>
                                        <input id="ktdoc" name="ktdoc" type="text" placeholder="'Trường này phải là số nguyên (0 < KTD < 9)'" class="form-control">
                                </div>
                                    <span class="form-message"></span>
                            </div>
                            <!-- <div style="margin-top:10px;" class="input-group">
                                    <div style=" box-sizing: border-box; width: 100%;" class="input-group-prepend">
                                            <span style="text-transform: uppercase; width: 170px; background-color: lightpink; border: none;" class="input-group-text">Kích Thước Dọc  </span>
                                        <input  type="text" name="ktdoc" id="ktdoc">

                                    </div>

                            </div> -->
                            <!-- <div style="margin-top:10px;" class="input-group">
                                    <div style=" box-sizing: border-box; width: 100%;" class="input-group-prepend">
                                            <span style="text-transform: uppercase; width: 170px; background-color: lightseagreen; border: none;" class="input-group-text">Kích Thước Ngang </span>
                                        <input type="text" name="ktngang" id="ktngang">

                                    </div>

                            </div> -->
                            <div style="margin-top:10px;" class="form-group input-group">
                                <div style=" box-sizing: border-box; width: 100%;" class="input-group-prepend">
                                        <span style="text-transform: uppercase; width: 170px; background-color: lightcoral; border: none;" class="input-group-text">Kích Thước Ngang </span>
                                        <input id="ktngang" name="ktngang" type="text" placeholder="'Trường này phải là số nguyên (0 < KTD < 6)'" class="form-control">
                                </div>
                                    <span class="form-message"></span>
                            </div>

                        </div>





                           
                    </div>
                    
                    
                    <button class="ui fluid blue button" type="submit">Save</button>
                </form>
            </div>
    
    
           
        </div>
</div>

<!----------Delete Rap------------>
<div class="bg-modal2">
        <div class="modal-content2 "> 
                    <div class="container">
                            <p>Joke Over! Tao không còn vui như lúc trước</p> 
                    </div>           
                    <form  class="ui form" method="POST"   >
                        <div class="field">
                            <input hidden  type="text" name="idrap2" id="idrap2">
                            <input hidden  value="3" type="text" name="check_option" id="check_option">
                            <button style="width: 100px; height: 50px; background-color: lightgreen;  border-radius: 5px; border: none;">YES</button>

                        </div>
                    </form>
                    <div class="field">
                        <button onclick="thoatDeleteRap()" style="width: 100px;height: 50px; background-color: lightcoral;  border-radius: 5px; border: none;">NO</button>
                                
                    </div>
                    
            
    
        </div>
</div>


<script>
    var thoatDeleteRap = function(){
        document.querySelector('.bg-modal2').style.display = 'none';

    };

    function deleteRap(idrap){
        document.querySelector('.bg-modal2').style.display = 'flex';
        document.getElementById('idrap2').value = idrap;

        $(window).scrollTop(0);

    };

        document.getElementById('add').addEventListener('click',
        function(){
            document.querySelector('.bg-modal1').style.display = 'flex';

        // var temp_tencumrap = document.getElementById('name')[0].value;
        
        // document.getElementById('temp_tencumrap').value = tenrap;

        var temp_tencumrap = document.getElementsByName('selectedname')[0].value;

        document.getElementById('temp_tencumrap1').value = temp_tencumrap;
        document.getElementById('rrap').value = '';
        document.getElementById('loairap').value = '';
        document.getElementById('ktdoc').value = '';
        document.getElementById('ktngang').value = '';
        });


    var addrap = function(){
        document.querySelector('.bg-modal1').style.display = 'flex';

        // var temp_tencumrap = document.getElementById('name')[0].value;
        
        // document.getElementById('temp_tencumrap').value = tenrap;

        var temp_tencumrap = document.getElementsByName('selectedname')[0].value;

        document.getElementById('temp_tencumrap1').value = temp_tencumrap;
        document.getElementById('rrap').value = '';
        document.getElementById('loairap').value = '';
        document.getElementById('ktdoc').value = '';
        document.getElementById('ktngang').value = '';

    };
    var weqww = function(){
        var temp_loairap1= document.getElementsByName('selectloairap1')[0].value;
    document.getElementById('edit_loairap').value = temp_loairap1;
    };
    function selectOption(index){ 
    document.getElementById("selectloairap1").options.selectedIndex = index;
    }
    function scrollToTopRap(tencumrap,idrap, idcumrap,tenrap, loairap, ktdoc, ktngang) {
        document.querySelector('.bg-modal').style.display = 'flex';

            $(window).scrollTop(0);
            document.getElementById('rrap').value = tenrap;
        document.getElementById('loairap').value = loairap;
        document.getElementById('ktdoc').value = ktdoc;
        document.getElementById('ktngang').value = ktngang;
        document.getElementById('idrap').value = idrap;
        document.getElementById('idcumrap').value = idcumrap;
        document.getElementById('check_option').value = '0';
        document.getElementById('temp_tencumrap').value = tencumrap;
        document.getElementById('edit_loairap').value =loairap;

            if (loairap === "2D" ){
                selectOption(0);
            }else if(loairap === "3D"){
                selectOption(1);
            }else{
                selectOption(2);
            }


        }

       

    var editrap = function(tencumrap,idrap, idcumrap,tenrap, loairap, ktdoc, ktngang){
        document.querySelector('.bg-modal').style.display = 'flex';

        document.getElementById('rrap').value = tenrap;
        document.getElementById('loairap').value = loairap;
        document.getElementById('ktdoc').value = ktdoc;
        document.getElementById('ktngang').value = ktngang;
        document.getElementById('idrap').value = idrap;
        document.getElementById('idcumrap').value = idcumrap;
        document.getElementById('check_option').value = '0';
        document.getElementById('temp_tencumrap').value = tencumrap;


    };
    var tatrap = function(){
        document.querySelector('.bg-modal').style.display = 'none';

    };
    var tatrap1 = function(){
        document.querySelector('.bg-modal1').style.display = 'none';

    };
    
    
</script>


<script>
    


    var weq = function(){
        var temp_loairap= document.getElementsByName('selectloairap')[0].value;
    document.getElementById('add_loairap').value = temp_loairap;
    };
    
    // Đối tượng `Validator`
    function Validator(options) {
        function getParent(element, selector) {
            while (element.parentElement) {
                if (element.parentElement.matches(selector)) {
                    return element.parentElement;
                }
                element = element.parentElement;
            }
        }
    
        var selectorRules = {};
    
        // Hàm thực hiện validate
        function validate(inputElement, rule) {
            var errorElement = getParent(inputElement, options.formGroupSelector).querySelector(options.errorSelector);
            var errorMessage;
    
            // Lấy ra các rules của selector
            var rules = selectorRules[rule.selector];
            
            // Lặp qua từng rule & kiểm tra
            // Nếu có lỗi thì dừng việc kiểm
            for (var i = 0; i < rules.length; ++i) {
                switch (inputElement.type) {
                    case 'radio':
                    case 'checkbox':
                        errorMessage = rules[i](
                            formElement.querySelector(rule.selector + ':checked')
                        );
                        break;
                    default:
                        errorMessage = rules[i](inputElement.value);
                }
                if (errorMessage) break;
            }
            
            if (errorMessage) {
                errorElement.innerText = errorMessage;
                getParent(inputElement, options.formGroupSelector).classList.add('invalid');
            } else {
                errorElement.innerText = '';
                getParent(inputElement, options.formGroupSelector).classList.remove('invalid');
            }
    
            return !errorMessage;
        }
    
        // Lấy element của form cần validate
        var formElement = document.querySelector(options.form);
        if (formElement) {
            // Khi submit form
            formElement.onsubmit = function (e) {
                e.preventDefault();
    
                var isFormValid = true;
    
                // Lặp qua từng rules và validate
                options.rules.forEach(function (rule) {
                    var inputElement = formElement.querySelector(rule.selector);
                    var isValid = validate(inputElement, rule);
                    if (!isValid) {
                        isFormValid = false;
                    }
                });
    
                if (isFormValid) {
                    // Trường hợp submit với javascript
                    if (typeof options.onSubmit === 'function') {
                        var enableInputs = formElement.querySelectorAll('[name]');
                        var formValues = Array.from(enableInputs).reduce(function (values, input) {
                            
                            switch(input.type) {
                                case 'radio':
                                    values[input.name] = formElement.querySelector('input[name="' + input.name + '"]:checked').value;
                                    break;
                                case 'checkbox':
                                    if (!input.matches(':checked')) {
                                        values[input.name] = '';
                                        return values;
                                    }
                                    if (!Array.isArray(values[input.name])) {
                                        values[input.name] = [];
                                    }
                                    values[input.name].push(input.value);
                                    break;
                                case 'file':
                                    values[input.name] = input.files;
                                    break;
                                default:
                                    values[input.name] = input.value;
                            }
    
                            return values;
                        }, {});
                        options.onSubmit(formValues);
                    }
                    // Trường hợp submit với hành vi mặc định
                    else {
                        formElement.submit();
                    }
                }
            }
    
            // Lặp qua mỗi rule và xử lý (lắng nghe sự kiện blur, input, ...)
            options.rules.forEach(function (rule) {
    
                // Lưu lại các rules cho mỗi input
                if (Array.isArray(selectorRules[rule.selector])) {
                    selectorRules[rule.selector].push(rule.test);
                } else {
                    selectorRules[rule.selector] = [rule.test];
                }
    
                var inputElements = formElement.querySelectorAll(rule.selector);
    
                Array.from(inputElements).forEach(function (inputElement) {
                   // Xử lý trường hợp blur khỏi input
                    inputElement.onblur = function () {
                        validate(inputElement, rule);
                    }
    
                    // Xử lý mỗi khi người dùng nhập vào input
                    inputElement.oninput = function () {
                        var errorElement = getParent(inputElement, options.formGroupSelector).querySelector(options.errorSelector);
                        errorElement.innerText = '';
                        getParent(inputElement, options.formGroupSelector).classList.remove('invalid');
                    } 
                });
            });
        }
    
    }
    
    
    
    // Định nghĩa rules
    // Nguyên tắc của các rules:
    // 1. Khi có lỗi => Trả ra message lỗi
    // 2. Khi hợp lệ => Không trả ra cái gì cả (undefined)
   
    
    Validator.isKTD = function (selector, message) {
        return {
            selector: selector,
            test: function (value) {
                var regex = /^[1-8]+$/;
                return regex.test(value) ? undefined :  message || 'Trường này phải là số nguyên (0 < KTD < 9)';
            }
        };
    }
    Validator.isKTN = function (selector, message) {
        return {
            selector: selector,
            test: function (value) {
                var regex = /^[1-5]+$/;
                return regex.test(value) ? undefined :  message || 'Trường này phải là số nguyên (0 < KTD < 6)';
            }
        }
    }
    
    
    
    
    // =================================================================
            document.addEventListener('DOMContentLoaded', function () {
              // Mong muốn của chúng ta
              Validator({
                form: '#formeaddrap',
                formGroupSelector: '.form-group',
                errorSelector: '.form-message',
                rules: [
                  Validator.isKTD('#ktdoc'),
                  Validator.isKTN('#ktngang')
                  
                ],
                // onSubmit: function (data) {
                //   // Call API
                //   console.log(data);
                // }
              });
      
      
              Validator({
                form: '#formeditrap',
                formGroupSelector: '.form-group',
                errorSelector: '.form-message',
                rules: [
                  Validator.isKTD('#ktdoc'),
                  Validator.isKTN('#ktngang')
                  
                ],
                // onSubmit: function (data) {
                //   // Call API
                //   console.log(data);
                // }
              });
            });
      
          </script>